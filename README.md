# Дипломная работа бэкенду проекта NewsExplorer для Yandex.Praktikum

## Версия

Актуальная версия проекта: **v1.0.0**

## Репозиторий проекта

Ссылка на репозиторий проекта: [https://github.com/pavel-sudomoin/news-explorer-api](https://github.com/pavel-sudomoin/news-explorer-api)

## Публичный сервер с проектом

Проект развернут на облачном сервере от *Яндекс.Облако*.

К серверу можно обратиться по его IP-адресу, либо по доменному имени.

Домен:
https://api.sudomoin-pavel-news-explorer.tk
https://www.api.sudomoin-pavel-news-explorer.tk
http://api.sudomoin-pavel-news-explorer.tk
http://www.api.sudomoin-pavel-news-explorer.tk

IP-адрес:
http://130.193.45.69

Сервер допускает работу с http и https протоколами.

## Описание

Проект представляет собой серверную часть (backend) для сервиса поиска и сохранения новостей *NewsExplorer*.

Проект разработан в учебных целях как дипломная работа для **Yandex.Praktikum**.

### Параметры сервера

По-умолчанию сервер запускается на 3000 порту.

### Функционал

Серверная часть обладает следующим функционалом:

* POST-запрос */signup* создаёт пользователя и возвращает его JSON.
  В теле запроса должен быть передан следующий JSON:
  ```json
  {
    "name": "TEST",
    "email": "email@ya.ru",
    "password": "12345678"
  }
  ```

* POST-запрос */signin* позволяет пользователю зарегистрироваться.
  В ответ вернётся JWT-токен (сроком на неделю), записанный в httpOnly куку.
  Для регистрации в теле запроса должен быть передан следующий JSON:
  ```json
  {
    "email": "email@ya.ru",
    "password": "12345678"
  }
  ```

* GET-запрос *users/me* возвращает возвращает JSON с информацией о пользователе (email и имя).

* GET-запрос */articles* возвращается JSON-список всех статей из базы данных.

* POST-запрос */articles* создаёт статью и возвращает её JSON.
  В теле запроса должен быть передан следующий JSON:
  ```json
  {
	  "keyword": "keyword",
	  "title": "title",
	  "text": "text",
	  "date": "date",
	  "source": "source",
	  "link": "https://ru.motorsport.com/",
	  "image": "https://cdn-1.motorsport.com/images/amp/6n9e44MY/s6/8-toyota-gazoo-racing-toyota-t.jpg"
  }
  ```

* DELETE-запрос */cards/cardId* (где *cardId* - идентификатор статьи) удаляет статью (если зарегистрированный пользователь является её создателем) и возвращает JSON удалённой статьи.

### Сообщения об ошибках

Если пользователь не прошёл регистрацию, то на любой валидный запрос, за исключением создания нового пользователя и регистрации, будет возвращаться статус ответа 401 и JSON { message: 'Необходима авторизация' }.

Если при регистрации пользователь передал неверную почту или пароль, то возвращается статус ответа 401 и JSON { message: 'Неправильные почта или пароль' }.

Если пользователя пытается удалить статью, которая не существует или которую создал не он, то возвращается статус ответа 404 и JSON { message: 'Вы не сохраняли статью с таким id' }.

В ответ на запрос по несуществующему адресу возвращается статус ответа 404 и JSON { "message": "Запрашиваемый ресурс не найден" }.

При записи данных в базу данных производится валидация полей. При непрохождении валидации выводится соответствующая ошибка валидации.

При любой иной ошибке, которая возникла во время обработки запроса, возвращается сообщение с этой ошибкой.

### Логгирование запросов и ошибок

Каждый запрос к API сохраняется в файле *request.log*.

Если API возвращает ошибку, информация о ней сохраняется в файле *error.log*.

### База данных

При разработке использована нереляционная база данных MongoDB.

### Схемы используемых в БД моделей

*Поля схемы пользователя:*

* name — имя пользователя, строка от 2 до 30 символов, обязательное поле;

* email — почта пользователя, строка, обязательно поле.

* password — пароль, строка не менее 8 символов, обязательно поле.

*Поля схемы статьи:*

* keyword — ключевое слово, по которому статью нашли. Обязательное поле-строка;

* title — заголовок статьи. Обязательное поле-строка;

* text — текст статьи. Обязательное поле-строка;

* date — дата статьи. Обязательное поле-строка;

* source — источник статьи. Обязательное поле-строка;

* link — ссылка на статью. Обязательное поле-строка. Должно быть URL-адресом;

* image — ссылка на иллюстрацию к статье. Обязательное поле-строка. Должно быть URL-адресом;

* owner — ссылка на модель автора статьи, тип ObjectId, проставляется автоматически. При отображении информации о статье база данных не возвращает это поле;

### Регистрация

Пароли хранятся в базе данных в хешированном виде, для чего используется модуль bcryptjs. API не возвращает хеш пароля при любых запросах.

После регистрации пользователю направляется JWT-токен (сроком на неделю), записанный в httpOnly куку.

Ключ подписи токена хранится в файле *.env*, размещённом на сервере.

## Используемые технологии

При разработке использован Node.js с фреймворком Express и базой данных MongoDB.

Код написан в соответствии со стайлгайдом Airbnb с применением линтера ESLint.

Пароли хешируются модулем bcryptjs. Токен с данными о пользователе соответствует стандарту JWT.

При деплое бэкенда на облачный сервер использован nginx как обратный прокси-сервер.

## Установка

Для работы необходимо иметь установленный Node.js.

Для установки требуется:

* Cкопировать все файлы из ветки *level-1* к себе в директорию.

* Запустить консоль и перейти в папку с проектом.

* Командой *npm i* установить все потребные плагины и пакеты.

После этого станут доступны два режима запуска сервера:

* команда *npm run start* запускает сервер на localhost:3000;

* команда *npm run dev* запускает сервер на localhost:3000 с хот релоудом;

## Планы по развитию

На дальнейших этапах разработки планируется добавить фронтенд сервиса *NewsExplorer* и задеплоить его на тот же сервер.

## Авторы

* [Yandex.Praktikum](https://praktikum.yandex.ru/)

* Судомоин Павел
